# Fast Terminal Dockerfile - Uses pre-built base image
ARG BASE_IMAGE=ghcr.io/your-org/claude-workflow-terminal-base:latest
FROM ${BASE_IMAGE}

# Switch to root to copy files
USER root

# Copy terminal server code (NEVER cached - always fresh)
COPY terminal_server.py .
COPY claude_profile_manager.py .
COPY terminal_startup.sh /app/terminal_startup.sh
RUN chmod +x /app/terminal_startup.sh

# Ensure proper ownership
RUN chown -R claude:claude /app

# Note: We DON'T switch back to USER claude here because the entrypoint script
# needs to run as root to start dockerd, then it switches to claude user

# The base image ENTRYPOINT will handle dockerd startup and user switching
CMD ["python", "terminal_server.py"]
