# Fast Terminal Dockerfile - Uses pre-built base image
ARG BASE_IMAGE=ghcr.io/your-org/claude-workflow-terminal-base:latest
FROM ${BASE_IMAGE}

# Switch to root to copy files
USER root

# Copy terminal server code (NEVER cached - always fresh)
COPY terminal_server.py .
COPY claude_profile_manager.py .
COPY claude_mcp_config.json .
COPY terminal_startup.sh /app/terminal_startup.sh
RUN chmod +x /app/terminal_startup.sh

# Ensure proper ownership
RUN chown -R claude:claude /app

# Note: Container starts as root to fix Docker socket permissions,
# then startup script switches to claude user

# Override base image ENTRYPOINT and use our startup script
# This is critical - the base image has an old entrypoint that tries to start Docker daemon
ENTRYPOINT []
CMD ["/app/terminal_startup.sh"]
