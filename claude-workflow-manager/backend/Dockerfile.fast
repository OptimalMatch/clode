# Fast Backend Dockerfile - Uses pre-built base image
ARG BASE_IMAGE=ghcr.io/your-org/claude-workflow-backend-base:latest
FROM ${BASE_IMAGE}

# Switch to root to copy files
USER root

# Copy source code (NEVER cached - always fresh)
COPY . .

# Ensure proper ownership
RUN chown -R claude:claude /app

# Switch back to claude user
USER claude

# Use the main module from the src directory for development
CMD ["sh", "-c", "if [ -f /app/src/main.py ]; then cd /app/src && /opt/venv/bin/uvicorn main:app --host 0.0.0.0 --port 8000 --reload; else /opt/venv/bin/uvicorn main:app --host 0.0.0.0 --port 8000 --reload; fi"]